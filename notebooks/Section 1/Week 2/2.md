# Protocol 2.1: Processing Climate Data for WEPP

**Document Version:** 1.0
**Date:** September 27, 2025
**Associated Project Task:** 2.1 - Develop and execute scripts to process raw climate data into WEPP-required `.cli` files.
**Corresponding Notebook:** `04_process_climate_data.ipynb`

---

## 1. Objective

To transform the point-based climate station data acquired from Rock:Clime into spatially continuous raster surfaces of key climate variables, and subsequently generate the formatted climate input files (`.cli`) required by the WEPP model.

## 2. Rationale and Strategic Justification

The WEPP model's physically-based simulation of erosion is driven by climate. This task translates sparse, point-based climate generator data into the spatially explicit inputs necessary to run WEPP across the entire study landscape. Creating these intermediate climate rasters is a critical data engineering step that ensures our erosion modeling is sensitive to regional climatic gradients. This structured process of building a beautiful, continuous data surface from raw inputs directly serves the project's core value of intellectual mastery and creates a tangible, high-quality asset for the subsequent, high-impact modeling phase.

## 3. Implementation Protocol (Jupyter Notebook Workflow)

### Step 1: Parse Raw Climate Parameter Files (`.par`)
* **Input:** Directory of `.par` files downloaded from Rock:Clime (`data/raw/climate/`).
* **Process:**
    1.  Write a Python function to parse the WEPP `.par` file format. These are fixed-width text files.
    2.  For each file, extract the station's latitude, longitude, and key climate statistics (e.g., mean monthly precipitation, number of wet days, mean/max temperatures).
    3.  Compile this information into a `pandas` DataFrame and convert it into a `geopandas` GeoDataFrame using the extracted coordinates.

### Step 2: Spatial Interpolation of Climate Variables
* **Input:** The GeoDataFrame of climate station statistics and the clipped DEM mosaic (`data/interim/dem_mosaic_clipped.tif`) to serve as the template grid for resolution and extent.
* **Process:**
    1.  For each key climate variable (e.g., `mean_annual_precip_mm`, `mean_jan_temp_c`), perform a spatial interpolation from the station points to the project's raster grid.
    2.  **Methodology:** Use Inverse Distance Weighting (IDW) as a robust and straightforward interpolation method. The `scipy.interpolate.griddata` function or similar tools in `gdal` are well-suited for this.
    3.  **Output:** A series of new GeoTIFF rasters representing the continuous surface of each climate variable across the study areas.
        * *Example File:* `data/processed/climate/mean_annual_precip.tif`


### Step 3: Generation of WEPP Climate Files (`.cli`)
This is the final, most specialized step. The WEPP model requires a unique `.cli` file for each hillslope it simulates. This protocol will generate these files on-the-fly during the main WEPP model execution (Task 2.3), but the logic will be developed and tested here.

* **Process:**
    1.  Develop a Python function that takes a coordinate (e.g., the outlet of a hillslope) as input.
    2.  This function will extract the values from the interpolated climate rasters (from Step 2) at that specific coordinate.
    3.  The function will then use a template `.cli` file or a dedicated Python library to write a new, correctly formatted `.cli` file using the extracted climate values for that location.
    4.  This function will be the core component used in the next stage to provide climate inputs to WEPP.

## 4. Deliverables

1.  **Intermediate Climate Rasters:** A complete set of GeoTIFF files for each interpolated climate variable, stored in `data/processed/climate/`.
2.  **Jupyter Notebook (`04_process_climate_data.ipynb`)**: A fully executed notebook that:
    * Details the parsing of `.par` files.
    * Implements and visualizes the results of the spatial interpolation.
    * Contains the finalized, tested Python function for generating location-specific `.cli` files.

## 5. Quality Control Checklist

* [ ] All `.par` files are successfully parsed, and coordinates are correct.
* [ ] The CRS of the climate station GeoDataFrame matches the project CRS.
* [ ] Interpolated climate rasters appear visually correct, with no obvious artifacts.
* [ ] The `.cli` generation function produces files that conform to the WEPP model's required format.
