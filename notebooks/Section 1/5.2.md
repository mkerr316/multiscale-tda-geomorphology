# Protocol 5.1.2: Pilot Analysis and A Priori Power Analysis

## 1. Objective

To conduct a formal statistical analysis of the pilot data to estimate key population parameters (variance, effect size) and use these estimates to perform an *a priori* power analysis. The ultimate goal is to determine the minimum required sample size (`n`) for the final study to confidently detect the hypothesized effects with a specified level of statistical power.

## 2. Rationale and Strategic Justification

This protocol is the intellectual culmination of the entire sampling design phase. It represents the ultimate expression of **Structured Idealism**: the idealistic goal of answering our scientific questions is grounded in the rigorous, logical structure of formal power analysis. This process provides a tangible service by replacing subjective guesswork with a statistically defensible number, ensuring that the final research effort is neither wastefully overpowered nor tragically underpowered. Achieving this beautiful harmony between our scientific ambition and our statistical capabilities is a foundational act of intellectual mastery and is essential for producing a high-impact, enthusiast-grade result.

## 3. Implementation Protocol (Jupyter Notebook Workflow)

### Step 1: Load and Prepare Pilot Data
* **Input:** The pilot data table (`pilot_data.csv`).
* **Process:** Load the data into a `pandas` DataFrame. Ensure data types are correct and separate the data by hypothesis.

### Step 2: Power Analysis for H1 (Landscape Characterization)
* **Hypothesis:** Geomorphic provinces exhibit statistically distinct multiscale topological signatures.
* **Statistical Test:** Multivariate Analysis of Variance (MANOVA).
* **Process:**
    1.  **Isolate Variables:** Create a subset of the data containing the group variable (geomorphic province) and the key TLSP response variables.
    2.  **Estimate Effect Size:**
        * Calculate the group means and covariance matrices for the TLSP variables from the pilot data.
        * Perform a MANOVA on the pilot data to get an initial estimate of an effect size statistic (e.g., Pillai's trace).
    3.  **Calculate Required Sample Size:** Use the `statsmodels.stats.power.MANOVA` class or a similar function. Input the estimated effect size, the number of groups (2 provinces), the number of response variables, a desired statistical power (conventionally **0.80**), and a significance level (alpha = **0.05**). The function will return the required sample size per group.

### Step 3: Power Analysis for H2 (Process Prediction)
* **Hypothesis:** Multiscale topological signatures are significant predictors of process-based erosion.
* **Statistical Test:** Multiple Linear Regression (used as a proxy for the more complex Gradient Boosting model for power analysis purposes).
* **Process:**
    1.  **Isolate Variables:** Create a subset of the data with the response variable (`sediment_yield`) and all predictor covariates (Tiers 1, 2, and 3).
    2.  **Estimate Effect Size:**
        * Fit a multiple linear regression model to the pilot data.
        * Calculate the model's R-squared ($R^2$).
        * Convert this to Cohen's $f^2$ effect size: $f^2 = R^2 / (1 - R^2)$.
    3.  **Calculate Required Sample Size:** Use the `statsmodels.stats.power.FTestAnovaPower.solve_power` function. Input the estimated effect size ($f^2$), the number of predictors, the desired power (**0.80**), and alpha (**0.05**). The function will return the total required sample size.

### Step 4: Synthesize Results and Finalize `n`
* **Process:**
    1.  Compare the sample size recommendations from the MANOVA and the multiple regression analyses.
    2.  **Select the larger of the two values as the final sample size `n` for each geomorphic province.** This ensures the study is sufficiently powered to address both core hypotheses.
    3.  Clearly document the final chosen `n` and the statistical justification.

## 4. Deliverables

1.  **Jupyter Notebook (`09_power_analysis.ipynb`)**: A fully executed notebook containing the detailed statistical analysis, code for the power calculations for both hypotheses, and a final markdown cell that explicitly states and justifies the final sample size `n`.
2.  **A project-level document or an update to the main README.md** that records the final sample size and the key parameters (power=0.8, alpha=0.05) used to derive it.

## 5. Quality Control Checklist

* [ ] The statistical assumptions for both power analyses (e.g., multivariate normality for MANOVA) have been checked and deemed reasonable for the pilot data.
* [ ] The code for calculating effect sizes and required sample sizes is clearly commented and correct.
* [ ] The final choice of `n` is explicitly justified as the maximum required by either hypothesis.
* [ ] All steps are documented and reproducible in the Jupyter Notebook.