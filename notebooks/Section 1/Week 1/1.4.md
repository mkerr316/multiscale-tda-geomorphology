# Protocol: Defining and Justifying the Covariate Suite

**Document Version:** 1.0
**Date:** September 27, 2025
**Associated Project Task:** 1.4 - Define Covariate Layers

---

## 1. Objective

To formally define the comprehensive, three-tiered suite of predictor covariates that will be generated and used for hypothesis testing. This protocol translates the theoretical and strategic discussions from the project proposals into a finalized, actionable list of data layers, complete with their scientific justification and a plan for their generation.

## 2. Rationale and Strategic Justification

The selection of covariates is a critical intellectual step that bridges the project's conceptual framework with its statistical execution. A well-designed covariate suite is not a mere collection of variables, but an elegant, structured system designed to deconstruct and quantify the landscape. This tiered approach ensures a multi-faceted analysis:

* **Tier 1 (Foundational):** Establishes a robust, multiscale baseline of landscape form, explicitly addressing known methodological issues like the "curvature crisis" by substituting traditional metrics with more stable alternatives [cite: Geomorphometry Methods and Metrics Discussion.md].
* **Tier 2 (Process-Proxy):** Allows for the stratification of the landscape into domains of distinct hydrological and erosional processes, providing a direct link between form and function [cite: Geomorphic Analysis Framework Development.md].
* **Tier 3 (Exploratory):** Incorporates the core innovation of this project—Topological Land-Surface Parameters (TLSPs)—along with other advanced metrics. This tier is designed to test whether these novel descriptors of landscape *shape* and *organization* provide new information beyond what is captured by traditional metrics of *form* [cite: Project Proposal Fall 2025.md].

This structured approach directly serves the project's goal of creating a more powerful and physically meaningful language for landscape analysis, ensuring that the subsequent sampling and modeling phases are built upon a foundation of maximum scientific integrity.

## 3. Finalized Three-Tiered Covariate Suite

The following covariates will be generated for the full extent of the study and validation areas.

### **Tier 1: Foundational Balancing Covariates**

These layers capture the first-order, multiscale structure of the topography and are essential for any robust sampling design.

| Covariate | Description & Justification |
| :--- | :--- |
| **Digital Elevation Model (DEM)** | The master variable representing elevation, a primary control on numerous environmental gradients (e.g., temperature, potential energy) [cite: Geomorphic Analysis Framework Development.md]. |
| **Slope Gradient** | The first derivative of elevation, representing the local gravitational potential energy gradient. It is a first-order control on a vast range of surface processes, from overland flow to mass wasting [cite: Geomorphic Analysis Framework Development.md]. |
| **Multiscale Wavelet-Based Roughness** | A robust measure of surface texture and complexity, calculated from the detail coefficients of a 2D wavelet transform of the DEM. **This metric serves as a direct, superior replacement for standard curvature measures**, avoiding the software-specific sign conventions and implementation ambiguities identified as the "curvature crisis" [cite: Geomorphometry Methods and Metrics Discussion.md, Geomorphic Analysis Framework Development.md]. It will be generated at multiple scales (e.g., corresponding to 30m, 90m, and 270m windows) to capture texture at local, hillslope, and broader scales. |
| **Multiscale Local Relief** | The range of elevation within a moving window. This captures the magnitude of vertical dissection at different spatial scales, reflecting the influence of different geomorphic processes operating over different extents [cite: Geomorphic Analysis Framework Development.md]. It will be calculated at the same multiple scales as roughness for comparative analysis. |

### **Tier 2: Process-Proxy Covariates**

These compound indices model specific physical processes and are used to stratify the landscape into distinct process domains.

| Covariate | Description & Justification |
| :--- | :--- |
| **Topographic Wetness Index (TWI)** | A proxy for the spatial distribution of steady-state soil moisture, calculated as `ln(a / tan(β))`, where `a` is the specific contributing area and `β` is slope. Essential for stratifying the landscape by its hydrological regime, a primary control on soil development and vegetation [cite: Geomorphic Analysis Framework Development.md]. |
| **Stream Power Index (SPI)** | A proxy for the erosive power of concentrated fluvial flow, calculated as `a * tan(β)`. It directly identifies zones of high geomorphic activity within the fluvial system and is critical for any study related to erosion and sediment transport [cite: Geomorphic Analysis Framework Development.md]. |

### **Tier 3: Exploratory & Novel Covariates**

These layers are derived from advanced computational methods and are designed to capture complex aspects of landscape organization.

| Covariate | Description & Justification |
| :--- | :--- |
| **Geomorphons** | A pattern-recognition approach that classifies each cell into one of ten fundamental landform types (e.g., ridge, valley, slope). This provides a powerful, non-topological baseline classification model against which the performance of the TLSP-based classification ($H_1$) can be rigorously compared [cite: Project Proposal Fall 2025.md, Geomorphology TDA Metrics Literature Review.md]. |
| **Topological Land-Surface Parameters (TLSPs)** | The core innovation of the project. These are rasters derived from a sliding-window TDA pipeline. Each pixel's value will be a summary statistic (e.g., persistence entropy, sum of persistence values) of a local persistence diagram. We will generate TLSPs for: <br> • **$H_0$ of the inverted DEM (Peaks/Ridges)** <br> • **$H_1$ of the DEM (Pits/Basins)** <br> These covariates quantify the *arrangement, connectivity, and nestedness* of landforms, capturing higher-order structural information missed by all other metrics [cite: Project Proposal Fall 2025.md]. |

## 4. Implementation Protocol (Jupyter Notebook Workflow)

This protocol will be implemented in a dedicated Jupyter Notebook (`03_generate_covariates.ipynb`).

### Step 1: Input Data
Load the clipped DEM mosaic (`dem_mosaic_clipped.tif`) from the `data/interim/` directory.

### Step 2: Hydrological Conditioning
Before calculating hydrological derivatives, the DEM must be conditioned to remove spurious sinks that interrupt flow paths.
* Use the `whitebox.fill_depressions()` tool on the input DEM. This is a mandatory prerequisite for accurate TWI and SPI calculation.

### Step 3: Covariate Generation
Using the hydrologically conditioned DEM as input, generate the following layers using the `whitebox` library.

* **Tier 1:**
    * `whitebox.slope()`
    * `whitebox.multiscale_topographic_position_image()` (or a custom wavelet script) for roughness.
    * `whitebox.max_elevation_deviation()` or similar moving-window statistics for local relief.
* **Tier 2:**
    * `whitebox.d_inf_flow_accumulation()` to generate the specific contributing area raster (`a`).
    * `whitebox.wetness_index()` to generate TWI.
    * Calculate SPI using raster algebra (`"a" * Tan("slope_radians")`).
* **Tier 3:**
    * `whitebox.geomorphons()`

**Note on TLSPs:** The generation of the final TLSP rasters is a major, computationally intensive task scheduled for Weeks 7-8 of the project. This protocol *defines* them as deliverables, but their actual creation will be handled in a separate, dedicated workflow (`04_generate_tlsp_rasters.ipynb`).

### Step 4: Standardization and Finalization
1.  **Co-registration:** Ensure all generated covariate rasters share the exact same grid (extent, cell size, alignment) as the source DEM.
2.  **Standardization:** For use in the sampling design, create a standardized version of each continuous covariate raster (Tier 1 & 2). Transform each to have a mean of 0 and a standard deviation of 1. This prevents variables with large numerical ranges from dominating distance calculations in the sampling algorithm [cite: Geomorphic Analysis Framework Development.md].
3.  **Organization:** Save all final covariate rasters to a new, organized directory structure.

data/
└── processed/
└── covariates/
├── unstandardized/
│   ├── slope.tif
│   ├── twi.tif
│   └── ...
└── standardized/
├── slope_std.tif
├── twi_std.tif
└── ...

## 5. Deliverables

1.  **Covariate Rasters:** A complete set of GeoTIFF files for each defined covariate, stored in the `data/processed/covariates/` directory, organized into `unstandardized` and `standardized` subdirectories.
2.  **Jupyter Notebook (`03_generate_covariates.ipynb`)**: A fully executed notebook containing the code and markdown cells that:
    * Document the parameters used for each geoprocessing tool (e.g., window sizes for multiscale metrics).
    * Provide a brief summary of each generated layer.
    * Visualize the key output rasters with appropriate color maps to confirm successful generation.

## 6. Quality Control Checklist

* [ ] The DEM has been hydrologically conditioned before calculating TWI and SPI.
* [ ] All Tier 1 and Tier 2 covariates, plus Geomorphons, have been successfully generated.
* [ ] Multiscale metrics (roughness, relief) have been generated at several documented window sizes.
* [ ] All output rasters are co-registered to the source DEM grid.
* [ ] Standardized versions of continuous covariates have been created.
* [ ] All files are named and organized according to the specified directory structure.
* [ ] The generation process is fully documented and reproducible in the Jupyter Notebook.