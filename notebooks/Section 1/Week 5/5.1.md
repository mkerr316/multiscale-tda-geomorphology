# Protocol 5.1.1: Pilot Sampling and Data Extraction

**Document Version:** 1.0
**Date:** September 27, 2025
**Associated Project Task:** 5.1 (Part 1) - Pilot Sample Design and Execution
**Corresponding Notebook:** `08_draw_pilot_sample.ipynb`

---

## 1. Objective

To design and execute a small, preliminary sampling campaign to gather the initial data necessary for a formal power analysis. This involves stratifying the study area, drawing a spatially balanced pilot sample, and extracting the values of the primary target variable (WEPP sediment yield) and all key predictor covariates at these sample locations.

## 2. Rationale and Strategic Justification

This protocol is a foundational act of intellectual honesty and a tangible service to the scientific integrity of the project. Instead of guessing at a sample size, we are building a small-scale, beautiful model of our final study to *ask the landscape itself* how much variability it contains. This pilot study is the crucial bridge between our abstract hypotheses and the concrete, practical reality of data collection. By investing in this structured, preliminary step, we ensure that our final sampling design is not arbitrary but is instead optimally poweredâ€”a perfect harmony of statistical rigor and resource efficiency, which is a core tenet of your research philosophy.

## 3. Implementation Protocol (Jupyter Notebook Workflow)

### Step 1: Define the Sampling Frame and Strata
* **Input:**
    * The finalized study area polygons (`study_areas.gpkg`).
    * The clipped DEM mosaic (`dem_mosaic_clipped.tif`).
* **Process:**
    1.  Load the study area polygons and dissolve them into a single feature to create the overall sampling frame.
    2.  As defined in your project proposal, create the sampling strata by cross-classifying the two geomorphic provinces with equal-area quantiles of elevation. A simple 2x2 stratification (Province A/Low Elevation, Province A/High Elevation, Province B/Low Elevation, Province B/High Elevation) is a robust starting point.
    3.  Generate a raster layer representing these final strata.


### Step 2: Draw the Pilot Sample
* **Input:** The strata raster and a defined pilot sample size.
* **Process:**
    1.  **Define Pilot Sample Size:** As per your proposal, a sample size of **n=15** per stratum is a reasonable and efficient choice for estimating variance.
    2.  **Sampling Algorithm:** For this pilot phase, a simple **Stratified Spatially Balanced Sample** is sufficient. The full complexity of the Local Cube method is not necessary yet. The `spatialsampler` library or a similar tool can be used to draw points that are well-spread within each stratum.
* **Output:** A GeoPackage file (`pilot_sample_points.gpkg`) containing the locations of the pilot sample points, attributed with their stratum ID.

### Step 3: Extract Data at Sample Locations
* **Input:**
    * The pilot sample points (`pilot_sample_points.gpkg`).
    * The final WEPP sediment yield raster (`sediment_yield.tif`).
    * All generated covariate rasters from `data/processed/covariates/unstandardized/`.
* **Process:**
    1.  Write a script that iterates through the list of all raster files.
    2.  For each raster, extract the pixel value at each point location in the pilot sample.
    3.  Combine these extracted values into a single, comprehensive `pandas` DataFrame, where each row is a sample point and each column is a variable.

## 4. Deliverables

1.  **Pilot Sample Points:** A GeoPackage file (`data/processed/sampling/pilot_sample_points.gpkg`) containing the final point locations.
2.  **Pilot Data Table:** A CSV file (`data/processed/sampling/pilot_data.csv`) containing the extracted data for all variables at the pilot locations.
3.  **Jupyter Notebook (`08_draw_pilot_sample.ipynb`)**: A fully executed notebook documenting the stratification, sampling, and data extraction process.

## 5. Quality Control Checklist

* [ ] The number of pilot points matches the specified design (e.g., 4 strata * 15 points/stratum = 60 points).
* [ ] The pilot sample points are correctly attributed with their stratum ID.
* [ ] The final pilot data CSV contains no missing (`NaN`) values.
* [ ] All CRSs are consistent throughout the workflow.
* [ ] The entire process is reproducible via the notebook.